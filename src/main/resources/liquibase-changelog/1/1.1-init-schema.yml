databaseChangeLog:
  - changeSet:
      id: 1
      author: bh
      changes:
        - sql: |
            CREATE TABLE parent (
                id BIGINT GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
                first_name VARCHAR(50) NOT NULL,
                last_name VARCHAR(50) NOT NULL,
                email VARCHAR(100) NOT NULL UNIQUE,
                password VARCHAR(100) NOT NULL,
                phone VARCHAR(20),
                creation_date TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP,
                created_by VARCHAR(40) DEFAULT '',
                update_date TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
                updated_by VARCHAR(40) DEFAULT ''
            );
        - sql: |
            CREATE TABLE child (
                id BIGINT GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
                parent_id BIGINT NOT NULL,
                first_name VARCHAR(50) NOT NULL,
                last_name VARCHAR(50) NOT NULL,
                birthdate DATE NOT NULL,
                notes VARCHAR(3000),
                creation_date TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP,
                created_by VARCHAR(40) DEFAULT '',
                update_date TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
                updated_by VARCHAR(40) DEFAULT '',
                CONSTRAINT fk_child_parent FOREIGN KEY (parent_id) REFERENCES parent(id) ON DELETE CASCADE
            );
        - sql: |
            CREATE TABLE medication (
                id BIGINT GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
                name VARCHAR(100) NOT NULL,
                brand VARCHAR(100),
                description VARCHAR(3000),
                dosage_form VARCHAR(50) NOT NULL,
                open_date DATE,
                instructions VARCHAR(3000),
                creation_date TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP,
                created_by VARCHAR(40) DEFAULT '',
                update_date TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
                updated_by VARCHAR(40) DEFAULT ''
            );
        - sql: |
            CREATE TABLE prescription (
                id BIGINT GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
                child_id BIGINT NOT NULL,
                illness_id BIGINT,                      
                injury_id BIGINT,
                chronic_condition_id BIGINT,                      
                medication_id BIGINT NOT NULL,
                dosage_amount NUMERIC(6,2) NOT NULL,
                dosage_unit VARCHAR(20) NOT NULL,
                frequency_per_day INT NOT NULL,
                start_date DATE NOT NULL,
                end_date DATE,
                notes VARCHAR(3000),
                creation_date TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP,
                created_by VARCHAR(40) DEFAULT '',
                update_date TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
                updated_by VARCHAR(40) DEFAULT '',
                CONSTRAINT fk_prescription_child FOREIGN KEY (child_id) REFERENCES child(id) ON DELETE CASCADE,
                CONSTRAINT fk_prescription_medication FOREIGN KEY (medication_id) REFERENCES medication(id) ON DELETE RESTRICT
            );
        - sql: |
            CREATE TABLE dosage_log (
                id BIGINT GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
                dosage_given NUMERIC(6,2) NOT NULL,
                administered_at TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP,
                notes VARCHAR(3000),
                creation_date TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP,
                created_by VARCHAR(40) DEFAULT '',
                update_date TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
                updated_by VARCHAR(40) DEFAULT ''
            );
        - sql: |
            CREATE TABLE notification (
                id BIGINT GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
                parent_id BIGINT NOT NULL,
                child_id BIGINT,
                message VARCHAR(300) NOT NULL,
                is_read BOOLEAN DEFAULT false,
                creation_date TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP,
                created_by VARCHAR(40) DEFAULT '',
                update_date TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
                updated_by VARCHAR(40) DEFAULT '',
                CONSTRAINT fk_notification_parent FOREIGN KEY (parent_id) REFERENCES parent(id) ON DELETE CASCADE,
                CONSTRAINT fk_notification_child FOREIGN KEY (child_id) REFERENCES child(id)
            );
        - sql: |
            CREATE TABLE illness (
                id BIGINT GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
                name VARCHAR(100) NOT NULL,
                illness_type VARCHAR(30),
                description VARCHAR(3000),
                child_id BIGINT NOT NULL,
                event_start DATE NOT NULL DEFAULT CURRENT_DATE,
                event_end DATE,
                creation_date TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP,
                created_by VARCHAR(20) DEFAULT '',
                update_date TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
                updated_by VARCHAR(40) DEFAULT ''
            );
        - sql: |
            CREATE TABLE chronic_condition (
                id BIGINT GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
                name VARCHAR(100) NOT NULL,
                description VARCHAR(3000),
                instructions VARCHAR(3000),
                notes VARCHAR(3000),
                child_id BIGINT NOT NULL,
                event_start DATE NOT NULL DEFAULT CURRENT_DATE,
                event_end DATE,
                creation_date TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP,
                created_by VARCHAR(20) DEFAULT '',
                update_date TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
                updated_by VARCHAR(40) DEFAULT ''
            );
        - sql: |
            CREATE TABLE injury (
                id BIGINT GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
                name VARCHAR(100) NOT NULL,
                injury_type VARCHAR(30) NOT NULL,
                description VARCHAR(3000),
                child_id BIGINT NOT NULL,
                event_start DATE NOT NULL DEFAULT CURRENT_DATE,
                event_end DATE,
                creation_date TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP,
                created_by VARCHAR(40) DEFAULT '',
                update_date TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
                updated_by VARCHAR(40) DEFAULT '',
                CONSTRAINT fk_injury_child FOREIGN KEY (child_id) REFERENCES child(id) ON DELETE CASCADE
            );
